/**
 * Sinon.JS 1.12.2, 2015/02/15
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @author Contributors: https://github.com/cjohansen/Sinon.JS/blob/master/AUTHORS
 *
 * (The BSD License)
 * 
 * Copyright (c) 2010-2014, Christian Johansen, christian@cjohansen.no
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 *     * Redistributions of source code must retain the above copyright notice,
 *       this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright notice,
 *       this list of conditions and the following disclaimer in the documentation
 *       and/or other materials provided with the distribution.
 *     * Neither the name of Christian Johansen nor the names of his contributors
 *       may be used to endorse or promote products derived from this software
 *       without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],function(){return t.sinon=e()}):"object"==typeof exports?module.exports=e():t.sinon=e()}(this,function(){var samsam,formatio;!function(){function define(t,e,n){"samsam"==t?samsam=e():"function"==typeof e&&0===t.length?lolex=e():"function"==typeof n&&(formatio=n(samsam))}define.amd={},("function"==typeof define&&define.amd&&function(t){define("samsam",t)}||"object"==typeof module&&function(t){module.exports=t()}||function(t){this.samsam=t()})(function(){function t(t){var e=t;return"number"==typeof t&&t!==e}function e(t){return f.toString.call(t).split(/[ \]]/)[1]}function n(t){if("Arguments"===e(t))return!0;if("object"!=typeof t||"number"!=typeof t.length||"Array"===e(t))return!1;if("function"==typeof t.callee)return!0;try{t[t.length]=6,delete t[t.length]}catch(n){return!0}return!1}function i(t){if(!t||1!==t.nodeType||!d)return!1;try{t.appendChild(d),t.removeChild(d)}catch(e){return!1}return!0}function r(t){var e,n=[];for(e in t)f.hasOwnProperty.call(t,e)&&n.push(e);return n}function o(t){return"function"==typeof t.getTime&&t.getTime()==t.valueOf()}function s(t){return 0===t&&1/t===-(1/0)}function a(e,n){return e===n||t(e)&&t(n)?0!==e||s(e)===s(n):void 0}function u(s,u){function l(t){return"object"!=typeof t||null===t||t instanceof Boolean||t instanceof Date||t instanceof Number||t instanceof RegExp||t instanceof String?!1:!0}function c(t,e){var n;for(n=0;n<t.length;n++)if(t[n]===e)return n;return-1}var d=[],h=[],p=[],g=[],m={};return function v(s,u,y,b){var _=typeof s,x=typeof u;if(s===u||t(s)||t(u)||null==s||null==u||"object"!==_||"object"!==x)return a(s,u);if(i(s)||i(u))return!1;var w=o(s),C=o(u);if((w||C)&&(!w||!C||s.getTime()!==u.getTime()))return!1;if(s instanceof RegExp&&u instanceof RegExp&&s.toString()!==u.toString())return!1;var k=e(s),T=e(u),E=r(s),S=r(u);if(n(s)||n(u)){if(s.length!==u.length)return!1}else if(_!==x||k!==T||E.length!==S.length)return!1;var A,j,F,D,N,q,O,M,P,L,$;for(j=0,F=E.length;F>j;j++){if(A=E[j],!f.hasOwnProperty.call(u,A))return!1;if(D=s[A],N=u[A],q=l(D),O=l(N),M=q?c(d,D):-1,P=O?c(h,N):-1,L=-1!==M?p[M]:y+"["+JSON.stringify(A)+"]",$=-1!==P?g[P]:b+"["+JSON.stringify(A)+"]",m[L+$])return!0;if(-1===M&&q&&(d.push(D),p.push(L)),-1===P&&O&&(h.push(N),g.push($)),q&&O&&(m[L+$]=!0),!v(D,N,L,$))return!1}return!0}(s,u,"$1","$2")}function l(t,e){if(0===e.length)return!0;var n,i,r,o;for(n=0,i=t.length;i>n;++n)if(c(t[n],e[0])){for(r=0,o=e.length;o>r;++r)if(!c(t[n+r],e[r]))return!1;return!0}return!1}var c,f=Object.prototype,d="undefined"!=typeof document&&document.createElement("div");return c=function h(t,n){if(n&&"function"==typeof n.test)return n.test(t);if("function"==typeof n)return n(t)===!0;if("string"==typeof n){n=n.toLowerCase();var i="string"==typeof t||!!t;return i&&String(t).toLowerCase().indexOf(n)>=0}if("number"==typeof n)return n===t;if("boolean"==typeof n)return n===t;if("undefined"==typeof n)return"undefined"==typeof t;if(null===n)return null===t;if("Array"===e(t)&&"Array"===e(n))return l(t,n);if(n&&"object"==typeof n){if(n===t)return!0;var r;for(r in n){var o=t[r];if("undefined"==typeof o&&"function"==typeof t.getAttribute&&(o=t.getAttribute(r)),null===n[r]||"undefined"==typeof n[r]){if(o!==n[r])return!1}else if("undefined"==typeof o||!h(o,n[r]))return!1}return!0}throw new Error("Matcher was not a string, a number, a function, a boolean or an object")},{isArguments:n,isElement:i,isDate:o,isNegZero:s,identical:a,deepEqual:u,match:c,keys:r}}),("function"==typeof define&&define.amd&&function(t){define("formatio",["samsam"],t)}||"object"==typeof module&&function(t){module.exports=t(require("samsam"))}||function(t){this.formatio=t(this.samsam)})(function(t){function e(t){if(!t)return"";if(t.displayName)return t.displayName;if(t.name)return t.name;var e=t.toString().match(/function\s+([^\(]+)/m);return e&&e[1]||""}function n(t,n){var i,r,o=e(n&&n.constructor),a=t.excludeConstructors||s.excludeConstructors||[];for(i=0,r=a.length;r>i;++i){if("string"==typeof a[i]&&a[i]===o)return"";if(a[i].test&&a[i].test(o))return""}return o}function i(t,e){if("object"!=typeof t)return!1;var n,i;for(n=0,i=e.length;i>n;++n)if(e[n]===t)return!0;return!1}function r(e,n,o,s){if("string"==typeof n){var u=e.quoteStrings,l="boolean"!=typeof u||u;return o||l?'"'+n+'"':n}if("function"==typeof n&&!(n instanceof RegExp))return r.func(n);if(o=o||[],i(n,o))return"[Circular]";if("[object Array]"===Object.prototype.toString.call(n))return r.array.call(e,n,o);if(!n)return String(1/n===-(1/0)?"-0":n);if(t.isElement(n))return r.element(n);if("function"==typeof n.toString&&n.toString!==Object.prototype.toString)return n.toString();var c,f;for(c=0,f=a.length;f>c;c++)if(n===a[c].object)return a[c].value;return r.object.call(e,n,o,s)}function o(t){for(var e in t)this[e]=t[e]}var s={excludeConstructors:["Object",/^.$/],quoteStrings:!0,limitChildrenCount:0},a=(Object.prototype.hasOwnProperty,[]);return"undefined"!=typeof global&&a.push({object:global,value:"[object global]"}),"undefined"!=typeof document&&a.push({object:document,value:"[object HTMLDocument]"}),"undefined"!=typeof window&&a.push({object:window,value:"[object Window]"}),r.func=function(t){return"function "+e(t)+"() {}"},r.array=function(t,e){e=e||[],e.push(t);var n,i,o=[];for(i=this.limitChildrenCount>0?Math.min(this.limitChildrenCount,t.length):t.length,n=0;i>n;++n)o.push(r(this,t[n],e));return i<t.length&&o.push("[... "+(t.length-i)+" more elements]"),"["+o.join(", ")+"]"},r.object=function(e,o,s){o=o||[],o.push(e),s=s||0;var a,u,l,c,f,d,h=[],p=t.keys(e).sort(),g=3;for(d=this.limitChildrenCount>0?Math.min(this.limitChildrenCount,p.length):p.length,c=0;d>c;++c)a=p[c],l=e[a],u=i(l,o)?"[Circular]":r(this,l,o,s+2),u=(/\s/.test(a)?'"'+a+'"':a)+": "+u,g+=u.length,h.push(u);var m=n(this,e),v=m?"["+m+"] ":"",y="";for(c=0,f=s;f>c;++c)y+=" ";return d<p.length&&h.push("[... "+(p.length-d)+" more elements]"),g+s>80?v+"{\n  "+y+h.join(",\n  "+y)+"\n"+y+"}":v+"{ "+h.join(", ")+" }"},r.element=function(t){var e,n,i,r,o,s=t.tagName.toLowerCase(),a=t.attributes,u=[];for(i=0,r=a.length;r>i;++i)e=a.item(i),n=e.nodeName.toLowerCase().replace("html:",""),o=e.nodeValue,("contenteditable"!==n||"inherit"!==o)&&o&&u.push(n+'="'+o+'"');var l="<"+s+(u.length>0?" ":""),c=t.innerHTML;c.length>20&&(c=c.substr(0,20)+"[...]");var f=l+u.join(" ")+">"+c+"</"+s+">";return f.replace(/ contentEditable="inherit"/,"")},o.prototype={functionName:e,configure:function(t){return new o(t)},constructorName:function(t){return n(this,t)},ascii:function(t,e,n){return r(this,t,e,n)}},o.prototype}),!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.lolex=t()}}(function(){var define,module,exports;return function t(e,n,i){function r(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return r(n?n:t)},c,c.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(require,module,exports){(function(global){function parseTime(t){if(!t)return 0;var e,n=t.split(":"),i=n.length,r=i,o=0;if(i>3||!/^(\d\d:){0,2}\d\d?$/.test(t))throw new Error("tick only understands numbers and 'h:m:s'");for(;r--;){if(e=parseInt(n[r],10),e>=60)throw new Error("Invalid time "+t);o+=e*Math.pow(60,i-r-1)}return 1e3*o}function getEpoch(t){if(!t)return 0;if("function"==typeof t.getTime)return t.getTime();if("number"==typeof t)return t;throw new TypeError("now should be milliseconds since UNIX epoch")}function inRange(t,e,n){return n&&n.callAt>=t&&n.callAt<=e}function mirrorDateProperties(t,e){e.now?t.now=function(){return t.clock.now}:delete t.now,e.toSource?t.toSource=function(){return e.toSource()}:delete t.toSource,t.toString=function(){return e.toString()},t.prototype=e.prototype,t.parse=e.parse,t.UTC=e.UTC,t.prototype.toUTCString=e.prototype.toUTCString;for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function createDate(){function t(e,n,i,r,o,s,a){switch(arguments.length){case 0:return new NativeDate(t.clock.now);case 1:return new NativeDate(e);case 2:return new NativeDate(e,n);case 3:return new NativeDate(e,n,i);case 4:return new NativeDate(e,n,i,r);case 5:return new NativeDate(e,n,i,r,o);case 6:return new NativeDate(e,n,i,r,o,s);default:return new NativeDate(e,n,i,r,o,s,a)}}return mirrorDateProperties(t,NativeDate)}function addTimer(t,e){if("undefined"==typeof e.func)throw new Error("Callback must be provided to timer calls");return t.timers||(t.timers={}),e.id=id++,e.createdAt=t.now,e.callAt=t.now+(e.delay||0),t.timers[e.id]=e,addTimerReturnsObject?{id:e.id,ref:function(){},unref:function(){}}:e.id}function firstTimerInRange(t,e,n){var i=t.timers,r=null;for(var o in i)inRange(e,n,i[o])&&(!r||~compareTimers(r,i[o]))&&(r=i[o]);return r}function compareTimers(t,e){return t.callAt<e.callAt?-1:t.callAt>e.callAt?1:t.immediate&&!e.immediate?-1:!t.immediate&&e.immediate?1:t.createdAt<e.createdAt?-1:t.createdAt>e.createdAt?1:t.id<e.id?-1:t.id>e.id?1:void 0}function callTimer(clock,timer){"number"==typeof timer.interval?clock.timers[timer.id].callAt+=timer.interval:delete clock.timers[timer.id];try{"function"==typeof timer.func?timer.func.apply(null,timer.args):eval(timer.func)}catch(e){var exception=e}if(clock.timers[timer.id]){if(exception)throw exception}else if(exception)throw exception}function uninstall(t,e){for(var n,i=0,r=t.methods.length;r>i;i++)if(n=t.methods[i],e[n].hadOwnProperty)e[n]=t["_"+n];else try{delete e[n]}catch(o){}t.methods=[]}function hijackMethod(t,e,n){if(n[e].hadOwnProperty=Object.prototype.hasOwnProperty.call(t,e),n["_"+e]=t[e],"Date"==e){var i=mirrorDateProperties(n[e],t[e]);t[e]=i}else{t[e]=function(){return n[e].apply(n,arguments)};for(var r in n[e])n[e].hasOwnProperty(r)&&(t[e][r]=n[e][r])}t[e].clock=n}/**
 * @author Christian Johansen (christian@cjohansen.no) and contributors
 * @license BSD
 *
 * Copyright (c) 2010-2014 Christian Johansen
 */
var timeoutResult=setTimeout(function(){},0),addTimerReturnsObject="object"==typeof timeoutResult;clearTimeout(timeoutResult);var NativeDate=Date,id=1,timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setImmediate:"undefined"!=typeof setImmediate?setImmediate:void 0,clearImmediate:"undefined"!=typeof clearImmediate?clearImmediate:void 0,setInterval:setInterval,clearInterval:clearInterval,Date:Date},keys=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};exports.timers=timers;var createClock=exports.createClock=function(t){var e={now:getEpoch(t),timeouts:{},Date:createDate()};return e.Date.clock=e,e.setTimeout=function(t,n){return addTimer(e,{func:t,args:Array.prototype.slice.call(arguments,2),delay:n})},e.clearTimeout=function(t){t&&(e.timers||(e.timers=[]),"object"==typeof t&&(t=t.id),t in e.timers&&delete e.timers[t])},e.setInterval=function(t,n){return addTimer(e,{func:t,args:Array.prototype.slice.call(arguments,2),delay:n,interval:n})},e.clearInterval=function(t){e.clearTimeout(t)},e.setImmediate=function(t){return addTimer(e,{func:t,args:Array.prototype.slice.call(arguments,1),immediate:!0})},e.clearImmediate=function(t){e.clearTimeout(t)},e.tick=function(t){t="number"==typeof t?t:parseTime(t);for(var n,i=e.now,r=e.now+t,o=e.now,s=firstTimerInRange(e,i,r);s&&r>=i;){if(e.timers[s.id]){i=e.now=s.callAt;try{callTimer(e,s)}catch(a){n=n||a}}s=firstTimerInRange(e,o,r),o=i}if(e.now=r,n)throw n;return e.now},e.reset=function(){e.timers={}},e};exports.install=function(t,e,n){"number"==typeof t&&(n=e,e=t,t=null),t||(t=global);var i=createClock(e);i.uninstall=function(){uninstall(i,t)},i.methods=n||[],0===i.methods.length&&(i.methods=keys(timers));for(var r=0,o=i.methods.length;o>r;r++)hijackMethod(t,i.methods[r],i);return i}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)})}();var define,sinon=function(){"use strict";function t(t,n,i){e=i.exports=t("./sinon/util/core"),t("./sinon/extend"),t("./sinon/typeOf"),t("./sinon/times_in_words"),t("./sinon/spy"),t("./sinon/call"),t("./sinon/behavior"),t("./sinon/stub"),t("./sinon/mock"),t("./sinon/collection"),t("./sinon/assert"),t("./sinon/sandbox"),t("./sinon/test"),t("./sinon/test_case"),t("./sinon/match"),t("./sinon/format"),t("./sinon/log_error")}var e,n="undefined"!=typeof module&&module.exports&&"function"==typeof require,i="function"==typeof define&&"object"==typeof define.amd&&define.amd;return i?define(t):n?(t(require,module.exports,module),e=module.exports):e={},e}();/**
 * Fake timer API
 * setTimeout
 * setInterval
 * clearTimeout
 * clearInterval
 * tick
 * reset
 * Date
 *
 * Inspired by jsUnitMockTimeOut from JsUnit
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2013 Christian Johansen
 */
if(/**
 * Sinon core utilities. For internal use only.
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2013 Christian Johansen
 */
function(t){function e(t){var e=!1;try{t.appendChild(l),e=l.parentNode==t}catch(n){return!1}finally{try{t.removeChild(l)}catch(n){}}return e}function n(t){return l&&t&&1===t.nodeType&&e(t)}function i(t){return"function"==typeof t||!!(t&&t.constructor&&t.call&&t.apply)}function r(t){return"number"==typeof t&&isNaN(t)}function o(t,e){for(var n in e)c.call(t,n)||(t[n]=e[n])}function s(t){return"function"==typeof t&&"function"==typeof t.restore&&t.restore.sinon}function a(t){return t.wrapMethod=function(t,e,n){if(!t)throw new TypeError("Should wrap property of object");if("function"!=typeof n)throw new TypeError("Method wrapper should be function");var r,s=t[e];if(i(s)){if(s.restore&&s.restore.sinon)r=new TypeError("Attempted to wrap "+e+" which is already wrapped");else if(s.calledBefore){var a=s.returns?"stubbed":"spied on";r=new TypeError("Attempted to wrap "+e+" which is already "+a)}}else r=new TypeError("Attempted to wrap "+typeof s+" property "+e+" as function");if(r)throw s&&s.stackTrace&&(r.stack+="\n--------------\n"+s.stackTrace),r;var u=t.hasOwnProperty?t.hasOwnProperty(e):c.call(t,e);return t[e]=n,n.displayName=e,n.stackTrace=new Error("Stack Trace for original").stack,n.restore=function(){u||delete t[e],t[e]===n&&(t[e]=s)},n.restore.sinon=!0,o(n,s),n},t.create=function(t){var e=function(){};return e.prototype=t,new e},t.deepEqual=function e(i,o){if(t.match&&t.match.isMatcher(i))return i.test(o);if("object"!=typeof i||"object"!=typeof o)return r(i)&&r(o)?!0:i===o;if(n(i)||n(o))return i===o;if(i===o)return!0;if(null===i&&null!==o||null!==i&&null===o)return!1;if(i instanceof RegExp&&o instanceof RegExp)return i.source===o.source&&i.global===o.global&&i.ignoreCase===o.ignoreCase&&i.multiline===o.multiline;var s=Object.prototype.toString.call(i);if(s!=Object.prototype.toString.call(o))return!1;if("[object Date]"==s)return i.valueOf()===o.valueOf();var a,u=0,l=0;if("[object Array]"==s&&i.length!==o.length)return!1;for(a in i){if(u+=1,!(a in o))return!1;if(!e(i[a],o[a]))return!1}for(a in o)l+=1;return u==l},t.functionName=function(t){var e=t.displayName||t.name;if(!e){var n=t.toString().match(/function ([^\s\(]+)/);e=n&&n[1]}return e},t.functionToString=function(){if(this.getCall&&this.callCount)for(var t,e,n=this.callCount;n--;){t=this.getCall(n).thisValue;for(e in t)if(t[e]===this)return e}return this.displayName||"sinon fake"},t.getConfig=function(e){var n={};e=e||{};var i=t.defaultConfig;for(var r in i)i.hasOwnProperty(r)&&(n[r]=e.hasOwnProperty(r)?e[r]:i[r]);return n},t.defaultConfig={injectIntoThis:!0,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:!0,useFakeServer:!0},t.timesInWords=function(t){return 1==t&&"once"||2==t&&"twice"||3==t&&"thrice"||(t||0)+" times"},t.calledInOrder=function(t){for(var e=1,n=t.length;n>e;e++)if(!t[e-1].calledBefore(t[e])||!t[e].called)return!1;return!0},t.orderByFirstCall=function(t){return t.sort(function(t,e){var n=t.getCall(0),i=e.getCall(0),r=n&&n.callId||-1,o=i&&i.callId||-1;return o>r?-1:1})},t.createStubInstance=function(e){if("function"!=typeof e)throw new TypeError("The constructor should be a function.");return t.stub(t.create(e.prototype))},t.restore=function(t){if(null!==t&&"object"==typeof t)for(var e in t)s(t[e])&&t[e].restore();else s(t)&&t.restore()},t}function u(t,e){a(e)}var l="undefined"!=typeof document&&document.createElement("div"),c=Object.prototype.hasOwnProperty,f="undefined"!=typeof module&&module.exports&&"function"==typeof require,d="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(d)define(u);else if(f)u(require,module.exports);else{if(!t)return;a(t)}}("object"==typeof sinon&&sinon||null),function(t){function e(t){function e(t){var e,i,r,o=Array.prototype.slice.call(arguments,1);for(i=0;i<o.length;i++){e=o[i];for(r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n&&e.hasOwnProperty("toString")&&e.toString!==t.toString&&(t.toString=e.toString)}return t}var n=function(){var t={constructor:function(){return"0"},toString:function(){return"1"},valueOf:function(){return"2"},toLocaleString:function(){return"3"},prototype:function(){return"4"},isPrototypeOf:function(){return"5"},propertyIsEnumerable:function(){return"6"},hasOwnProperty:function(){return"7"},length:function(){return"8"},unique:function(){return"9"}},e=[];for(var n in t)e.push(t[n]());return"0123456789"!==e.join("")}();return t.extend=e,t.extend}function n(t,n,i){var r=t("./util/core");i.exports=e(r)}var i="undefined"!=typeof module&&module.exports&&"function"==typeof require,r="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(r)define(n);else if(i)n(require,module.exports,module);else{if(!t)return;e(t)}}("object"==typeof sinon&&sinon||null),function(t){function e(t){function e(t){switch(t){case 1:return"once";case 2:return"twice";case 3:return"thrice";default:return(t||0)+" times"}}return t.timesInWords=e,t.timesInWords}function n(t,n,i){var r=t("./util/core");i.exports=e(r)}var i="undefined"!=typeof module&&module.exports&&"function"==typeof require,r="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(r)define(n);else if(i)n(require,module.exports,module);else{if(!t)return;e(t)}}("object"==typeof sinon&&sinon||null),/**
 * Format functions
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2014 Christian Johansen
 */
function(t,e){function n(t){function e(t){if(null===t)return"null";if(void 0===t)return"undefined";var e=Object.prototype.toString.call(t);return e.substring(8,e.length-1).toLowerCase()}return t.typeOf=e,t.typeOf}function i(t,e,i){var r=t("./util/core");i.exports=n(r)}var r="undefined"!=typeof module&&module.exports&&"function"==typeof require,o="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(o)define(i);else if(r)i(require,module.exports,module);else{if(!t)return;n(t)}}("object"==typeof sinon&&sinon||null,"object"==typeof formatio&&formatio),/**
 * Match functions
 *
 * @author Maximilian Antoni (mail@maxantoni.de)
 * @license BSD
 *
 * Copyright (c) 2012 Maximilian Antoni
 */
function(t){function e(t){function e(e,n,i){var r=t.typeOf(e);if(r!==n)throw new TypeError("Expected type of "+i+" to be "+n+", but was "+r)}function n(t){return o.isPrototypeOf(t)}function i(e,n){if(null===n||void 0===n)return!1;for(var r in e)if(e.hasOwnProperty(r)){var o=e[r],a=n[r];if(s.isMatcher(o)){if(!o.test(a))return!1}else if("object"===t.typeOf(o)){if(!i(o,a))return!1}else if(!t.deepEqual(o,a))return!1}return!0}function r(n,i){return function(r,o){e(r,"string","property");var a=1===arguments.length,u=i+'("'+r+'"';return a||(u+=", "+o),u+=")",s(function(e){return void 0!==e&&null!==e&&n(e,r)?a||t.deepEqual(o,e[r]):!1},u)}}var o={toString:function(){return this.message}};o.or=function(e){if(!arguments.length)throw new TypeError("Matcher expected");n(e)||(e=s(e));var i=this,r=t.create(o);return r.test=function(t){return i.test(t)||e.test(t)},r.message=i.message+".or("+e.message+")",r},o.and=function(e){if(!arguments.length)throw new TypeError("Matcher expected");n(e)||(e=s(e));var i=this,r=t.create(o);return r.test=function(t){return i.test(t)&&e.test(t)},r.message=i.message+".and("+e.message+")",r};var s=function(e,n){var r=t.create(o),s=t.typeOf(e);switch(s){case"object":if("function"==typeof e.test)return r.test=function(t){return e.test(t)===!0},r.message="match("+t.functionName(e.test)+")",r;var a=[];for(var u in e)e.hasOwnProperty(u)&&a.push(u+": "+e[u]);r.test=function(t){return i(e,t)},r.message="match("+a.join(", ")+")";break;case"number":r.test=function(t){return e==t};break;case"string":r.test=function(t){return"string"!=typeof t?!1:-1!==t.indexOf(e)},r.message='match("'+e+'")';break;case"regexp":r.test=function(t){return"string"!=typeof t?!1:e.test(t)};break;case"function":r.test=e,n?r.message=n:r.message="match("+t.functionName(e)+")";break;default:r.test=function(n){return t.deepEqual(e,n)}}return r.message||(r.message="match("+e+")"),r};return s.isMatcher=n,s.any=s(function(){return!0},"any"),s.defined=s(function(t){return null!==t&&void 0!==t},"defined"),s.truthy=s(function(t){return!!t},"truthy"),s.falsy=s(function(t){return!t},"falsy"),s.same=function(t){return s(function(e){return t===e},"same("+t+")")},s.typeOf=function(n){return e(n,"string","type"),s(function(e){return t.typeOf(e)===n},'typeOf("'+n+'")')},s.instanceOf=function(n){return e(n,"function","type"),s(function(t){return t instanceof n},"instanceOf("+t.functionName(n)+")")},s.has=r(function(t,e){return"object"==typeof t?e in t:void 0!==t[e]},"has"),s.hasOwn=r(function(t,e){return t.hasOwnProperty(e)},"hasOwn"),s.bool=s.typeOf("boolean"),s.number=s.typeOf("number"),s.string=s.typeOf("string"),s.object=s.typeOf("object"),s.func=s.typeOf("function"),s.array=s.typeOf("array"),s.regexp=s.typeOf("regexp"),s.date=s.typeOf("date"),t.match=s,s}function n(t,n,i){var r=t("./util/core");i.exports=e(r)}var i="undefined"!=typeof module&&module.exports&&"function"==typeof require,r="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(r)define(n);else if(i)n(require,module.exports,module);else{if(!t)return;e(t)}}("object"==typeof sinon&&sinon||null),/**
 * Format functions
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2014 Christian Johansen
 */
function(t,e){function n(t){function n(t){return""+t}function i(){function t(){return n.ascii.apply(n,arguments)}var n=e.configure({quoteStrings:!1,limitChildrenCount:250});return t}function r(t){function e(t){return"object"==typeof t&&t.toString===Object.prototype.toString?i.inspect(t):t}try{var i=require("util")}catch(r){}return i?e:n}var o,s="undefined"!=typeof module&&module.exports&&"function"==typeof require;if(s)try{e=require("formatio")}catch(a){}return o=e?i():s?r():n,t.format=o,t.format}function i(t,e,i){var r=t("./util/core");i.exports=n(r)}var r="undefined"!=typeof module&&module.exports&&"function"==typeof require,o="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(o)define(i);else if(r)i(require,module.exports,module);else{if(!t)return;n(t)}}("object"==typeof sinon&&sinon||null,"object"==typeof formatio&&formatio),/**
  * Spy calls
  *
  * @author Christian Johansen (christian@cjohansen.no)
  * @author Maximilian Antoni (mail@maxantoni.de)
  * @license BSD
  *
  * Copyright (c) 2010-2013 Christian Johansen
  * Copyright (c) 2013 Maximilian Antoni
  */
function(t){function e(t){function e(e,n,r){var o=t.functionName(e)+n;throw r.length&&(o+=" Received ["+i.call(r).join(", ")+"]"),new Error(o)}function n(e,n,i,o,s,a){if("number"!=typeof a)throw new TypeError("Call id is not a number");var u=t.create(r);return u.proxy=e,u.thisValue=n,u.args=i,u.returnValue=o,u.exception=s,u.callId=a,u}var i=Array.prototype.slice,r={calledOn:function(e){return t.match&&t.match.isMatcher(e)?e.test(this.thisValue):this.thisValue===e},calledWith:function(){for(var e=0,n=arguments.length;n>e;e+=1)if(!t.deepEqual(arguments[e],this.args[e]))return!1;return!0},calledWithMatch:function(){for(var e=0,n=arguments.length;n>e;e+=1){var i=this.args[e],r=arguments[e];if(!t.match||!t.match(r).test(i))return!1}return!0},calledWithExactly:function(){return arguments.length==this.args.length&&this.calledWith.apply(this,arguments)},notCalledWith:function(){return!this.calledWith.apply(this,arguments)},notCalledWithMatch:function(){return!this.calledWithMatch.apply(this,arguments)},returned:function(e){return t.deepEqual(e,this.returnValue)},threw:function(t){return"undefined"!=typeof t&&this.exception?this.exception===t||this.exception.name===t:!!this.exception},calledWithNew:function(){return this.proxy.prototype&&this.thisValue instanceof this.proxy},calledBefore:function(t){return this.callId<t.callId},calledAfter:function(t){return this.callId>t.callId},callArg:function(t){this.args[t]()},callArgOn:function(t,e){this.args[t].apply(e)},callArgWith:function(t){this.callArgOnWith.apply(this,[t,null].concat(i.call(arguments,1)))},callArgOnWith:function(t,e){var n=i.call(arguments,2);this.args[t].apply(e,n)},"yield":function(){this.yieldOn.apply(this,[null].concat(i.call(arguments,0)))},yieldOn:function(t){for(var n=this.args,r=0,o=n.length;o>r;++r)if("function"==typeof n[r])return void n[r].apply(t,i.call(arguments,1));e(this.proxy," cannot yield since no callback was passed.",n)},yieldTo:function(t){this.yieldToOn.apply(this,[t,null].concat(i.call(arguments,1)))},yieldToOn:function(t,n){for(var r=this.args,o=0,s=r.length;s>o;++o)if(r[o]&&"function"==typeof r[o][t])return void r[o][t].apply(n,i.call(arguments,2));e(this.proxy," cannot yield to '"+t+"' since no callback was passed.",r)},toString:function(){for(var e=this.proxy.toString()+"(",n=[],i=0,r=this.args.length;r>i;++i)n.push(t.format(this.args[i]));return e=e+n.join(", ")+")","undefined"!=typeof this.returnValue&&(e+=" => "+t.format(this.returnValue)),this.exception&&(e+=" !"+this.exception.name,this.exception.message&&(e+="("+this.exception.message+")")),e}};return r.invokeCallback=r["yield"],n.toString=r.toString,t.spyCall=n,n}function n(t,n,i){var r=t("./util/core");t("./match"),i.exports=e(r)}var i="undefined"!=typeof module&&module.exports&&"function"==typeof require,r="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(r)define(n);else if(i)n(require,module.exports,module);else{if(!t)return;e(t)}}("object"==typeof sinon&&sinon||null),/**
  * Spy functions
  *
  * @author Christian Johansen (christian@cjohansen.no)
  * @license BSD
  *
  * Copyright (c) 2010-2013 Christian Johansen
  */
function(sinon){function makeApi(sinon){function spy(t,e){if(!e&&"function"==typeof t)return spy.create(t);if(!t&&!e)return spy.create(function(){});var n=t[e];return sinon.wrapMethod(t,e,spy.create(n))}function matchingFake(t,e,n){if(t)for(var i=0,r=t.length;r>i;i++)if(t[i].matches(e,n))return t[i]}function incrementCallCount(){this.called=!0,this.callCount+=1,this.notCalled=!1,this.calledOnce=1==this.callCount,this.calledTwice=2==this.callCount,this.calledThrice=3==this.callCount}function createCallProperties(){this.firstCall=this.getCall(0),this.secondCall=this.getCall(1),this.thirdCall=this.getCall(2),this.lastCall=this.getCall(this.callCount-1)}function createProxy(func,proxyLength){var p;return proxyLength?eval("p = (function proxy("+vars.substring(0,2*proxyLength-1)+") { return p.invoke(func, this, slice.call(arguments)); });"):p=function(){return p.invoke(func,this,slice.call(arguments))},p}function delegateToCalls(t,e,n,i){spyApi[t]=function(){if(!this.called)return i?i.apply(this,arguments):!1;for(var r,o=0,s=0,a=this.callCount;a>s;s+=1)if(r=this.getCall(s),r[n||t].apply(r,arguments)&&(o+=1,e))return!0;return o===this.callCount}}var push=Array.prototype.push,slice=Array.prototype.slice,callId=0,vars="a,b,c,d,e,f,g,h,i,j,k,l",uuid=0,spyApi={reset:function(){if(this.invoking){var t=new Error("Cannot reset Sinon function while invoking it. Move the call to .reset outside of the callback.");throw t.name="InvalidResetException",t}if(this.called=!1,this.notCalled=!0,this.calledOnce=!1,this.calledTwice=!1,this.calledThrice=!1,this.callCount=0,this.firstCall=null,this.secondCall=null,this.thirdCall=null,this.lastCall=null,this.args=[],this.returnValues=[],this.thisValues=[],this.exceptions=[],this.callIds=[],this.fakes)for(var e=0;e<this.fakes.length;e++)this.fakes[e].reset();return this},create:function(t,e){var n;"function"!=typeof t?t=function(){}:n=sinon.functionName(t),e||(e=t.length);var i=createProxy(t,e);return sinon.extend(i,spy),delete i.create,sinon.extend(i,t),i.reset(),i.prototype=t.prototype,i.displayName=n||"spy",i.toString=sinon.functionToString,i.instantiateFake=sinon.spy.create,i.id="spy#"+uuid++,i},invoke:function(t,e,n){var i,r,o=matchingFake(this.fakes,n);incrementCallCount.call(this),push.call(this.thisValues,e),push.call(this.args,n),push.call(this.callIds,callId++),createCallProperties.call(this);try{this.invoking=!0,r=o?o.invoke(t,e,n):(this.func||t).apply(e,n);var s=this.getCall(this.callCount-1);s.calledWithNew()&&"object"!=typeof r&&(r=e)}catch(a){i=a}finally{delete this.invoking}if(push.call(this.exceptions,i),push.call(this.returnValues,r),createCallProperties.call(this),void 0!==i)throw i;return r},named:function(t){return this.displayName=t,this},getCall:function(t){return 0>t||t>=this.callCount?null:sinon.spyCall(this,this.thisValues[t],this.args[t],this.returnValues[t],this.exceptions[t],this.callIds[t])},getCalls:function(){var t,e=[];for(t=0;t<this.callCount;t++)e.push(this.getCall(t));return e},calledBefore:function(t){return this.called?t.called?this.callIds[0]<t.callIds[t.callIds.length-1]:!0:!1},calledAfter:function(t){return this.called&&t.called?this.callIds[this.callCount-1]>t.callIds[t.callCount-1]:!1},withArgs:function(){var t=slice.call(arguments);if(this.fakes){var e=matchingFake(this.fakes,t,!0);if(e)return e}else this.fakes=[];var n=this,i=this.instantiateFake();i.matchingAguments=t,i.parent=this,push.call(this.fakes,i),i.withArgs=function(){return n.withArgs.apply(n,arguments)};for(var r=0;r<this.args.length;r++)i.matches(this.args[r])&&(incrementCallCount.call(i),push.call(i.thisValues,this.thisValues[r]),push.call(i.args,this.args[r]),push.call(i.returnValues,this.returnValues[r]),push.call(i.exceptions,this.exceptions[r]),push.call(i.callIds,this.callIds[r]));return createCallProperties.call(i),i},matches:function(t,e){var n=this.matchingAguments;return n.length<=t.length&&sinon.deepEqual(n,t.slice(0,n.length))?!e||n.length==t.length:void 0},printf:function(t){var e,n=this,i=slice.call(arguments,1);return(t||"").replace(/%(.)/g,function(t,r){return e=spyApi.formatters[r],"function"==typeof e?e.call(null,n,i):isNaN(parseInt(r,10))?"%"+r:sinon.format(i[r-1])})}};return delegateToCalls("calledOn",!0),delegateToCalls("alwaysCalledOn",!1,"calledOn"),delegateToCalls("calledWith",!0),delegateToCalls("calledWithMatch",!0),delegateToCalls("alwaysCalledWith",!1,"calledWith"),delegateToCalls("alwaysCalledWithMatch",!1,"calledWithMatch"),delegateToCalls("calledWithExactly",!0),delegateToCalls("alwaysCalledWithExactly",!1,"calledWithExactly"),delegateToCalls("neverCalledWith",!1,"notCalledWith",function(){return!0}),delegateToCalls("neverCalledWithMatch",!1,"notCalledWithMatch",function(){return!0}),delegateToCalls("threw",!0),delegateToCalls("alwaysThrew",!1,"threw"),delegateToCalls("returned",!0),delegateToCalls("alwaysReturned",!1,"returned"),delegateToCalls("calledWithNew",!0),delegateToCalls("alwaysCalledWithNew",!1,"calledWithNew"),delegateToCalls("callArg",!1,"callArgWith",function(){throw new Error(this.toString()+" cannot call arg since it was not yet invoked.")}),spyApi.callArgWith=spyApi.callArg,delegateToCalls("callArgOn",!1,"callArgOnWith",function(){throw new Error(this.toString()+" cannot call arg since it was not yet invoked.")}),spyApi.callArgOnWith=spyApi.callArgOn,delegateToCalls("yield",!1,"yield",function(){throw new Error(this.toString()+" cannot yield since it was not yet invoked.")}),spyApi.invokeCallback=spyApi["yield"],delegateToCalls("yieldOn",!1,"yieldOn",function(){throw new Error(this.toString()+" cannot yield since it was not yet invoked.")}),delegateToCalls("yieldTo",!1,"yieldTo",function(t){throw new Error(this.toString()+" cannot yield to '"+t+"' since it was not yet invoked.")}),delegateToCalls("yieldToOn",!1,"yieldToOn",function(t){throw new Error(this.toString()+" cannot yield to '"+t+"' since it was not yet invoked.")}),spyApi.formatters={c:function(t){return sinon.timesInWords(t.callCount)},n:function(t){return t.toString()},C:function(t){for(var e=[],n=0,i=t.callCount;i>n;++n){var r="    "+t.getCall(n).toString();/\n/.test(e[n-1])&&(r="\n"+r),push.call(e,r)}return e.length>0?"\n"+e.join("\n"):""},t:function(t){for(var e=[],n=0,i=t.callCount;i>n;++n)push.call(e,sinon.format(t.thisValues[n]));return e.join(", ")},"*":function(t,e){for(var n=[],i=0,r=e.length;r>i;++i)push.call(n,sinon.format(e[i]));return n.join(", ")}},sinon.extend(spy,spyApi),spy.spyCall=sinon.spyCall,sinon.spy=spy,spy}function loadDependencies(t,e,n){var i=t("./util/core");t("./call"),n.exports=makeApi(i)}var isNode="undefined"!=typeof module&&module.exports&&"function"==typeof require,isAMD="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(isAMD)define(loadDependencies);else if(isNode)loadDependencies(require,module.exports,module);else{if(!sinon)return;makeApi(sinon)}}("object"==typeof sinon&&sinon||null),/**
 * Stub behavior
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @author Tim Fischbach (mail@timfischbach.de)
 * @license BSD
 *
 * Copyright (c) 2010-2013 Christian Johansen
 */
function(t){function e(t,e){return"string"==typeof t?(this.exception=new Error(e||""),this.exception.name=t):t?this.exception=t:this.exception=new Error("Error"),this}function n(t,e){var n=t.callArgAt;if(0>n){for(var i=t.callArgProp,r=0,o=e.length;o>r;++r){if(!i&&"function"==typeof e[r])return e[r];if(i&&e[r]&&"function"==typeof e[r][i])return e[r][i]}return null}return e[n]}function i(t){function i(e,n,i){if(e.callArgAt<0){var r;return r=e.callArgProp?t.functionName(e.stub)+" expected to yield to '"+e.callArgProp+"', but no object with such a property was passed.":t.functionName(e.stub)+" expected to yield, but no callback was passed.",i.length>0&&(r+=" Received ["+s.call(i,", ")+"]"),r}return"argument at index "+e.callArgAt+" is not a function: "+n}function r(t,e){if("number"==typeof t.callArgAt){var r=n(t,e);if("function"!=typeof r)throw new TypeError(i(t,r,e));t.callbackAsync?a(function(){r.apply(t.callbackContext,t.callbackArguments)}):r.apply(t.callbackContext,t.callbackArguments)}}var u={create:function(e){var n=t.extend({},t.behavior);return delete n.create,n.stub=e,n},isPresent:function(){return"number"==typeof this.callArgAt||this.exception||"number"==typeof this.returnArgAt||this.returnThis||this.returnValueDefined},invoke:function(t,e){if(r(this,e),this.exception)throw this.exception;return"number"==typeof this.returnArgAt?e[this.returnArgAt]:this.returnThis?t:this.returnValue},onCall:function(t){return this.stub.onCall(t)},onFirstCall:function(){return this.stub.onFirstCall()},onSecondCall:function(){return this.stub.onSecondCall()},onThirdCall:function(){return this.stub.onThirdCall()},withArgs:function(){throw new Error('Defining a stub by invoking "stub.onCall(...).withArgs(...)" is not supported. Use "stub.withArgs(...).onCall(...)" to define sequential behavior for calls with certain arguments.')},callsArg:function(t){if("number"!=typeof t)throw new TypeError("argument index is not number");return this.callArgAt=t,this.callbackArguments=[],this.callbackContext=void 0,this.callArgProp=void 0,this.callbackAsync=!1,this},callsArgOn:function(t,e){if("number"!=typeof t)throw new TypeError("argument index is not number");if("object"!=typeof e)throw new TypeError("argument context is not an object");return this.callArgAt=t,this.callbackArguments=[],this.callbackContext=e,this.callArgProp=void 0,this.callbackAsync=!1,this},callsArgWith:function(t){if("number"!=typeof t)throw new TypeError("argument index is not number");return this.callArgAt=t,this.callbackArguments=o.call(arguments,1),this.callbackContext=void 0,this.callArgProp=void 0,this.callbackAsync=!1,this},callsArgOnWith:function(t,e){if("number"!=typeof t)throw new TypeError("argument index is not number");if("object"!=typeof e)throw new TypeError("argument context is not an object");return this.callArgAt=t,this.callbackArguments=o.call(arguments,2),this.callbackContext=e,this.callArgProp=void 0,this.callbackAsync=!1,this},yields:function(){return this.callArgAt=-1,this.callbackArguments=o.call(arguments,0),this.callbackContext=void 0,this.callArgProp=void 0,this.callbackAsync=!1,this},yieldsOn:function(t){if("object"!=typeof t)throw new TypeError("argument context is not an object");return this.callArgAt=-1,this.callbackArguments=o.call(arguments,1),this.callbackContext=t,this.callArgProp=void 0,this.callbackAsync=!1,this},yieldsTo:function(t){return this.callArgAt=-1,this.callbackArguments=o.call(arguments,1),this.callbackContext=void 0,this.callArgProp=t,this.callbackAsync=!1,this},yieldsToOn:function(t,e){if("object"!=typeof e)throw new TypeError("argument context is not an object");return this.callArgAt=-1,this.callbackArguments=o.call(arguments,2),this.callbackContext=e,this.callArgProp=t,this.callbackAsync=!1,this},"throws":e,throwsException:e,returns:function(t){return this.returnValue=t,this.returnValueDefined=!0,this},returnsArg:function(t){if("number"!=typeof t)throw new TypeError("argument index is not number");return this.returnArgAt=t,this},returnsThis:function(){return this.returnThis=!0,this}};for(var l in u)u.hasOwnProperty(l)&&l.match(/^(callsArg|yields)/)&&!l.match(/Async/)&&(u[l+"Async"]=function(t){return function(){var e=this[t].apply(this,arguments);return this.callbackAsync=!0,e}}(l));return t.behavior=u,u}function r(t,e,n){var r=t("./util/core");n.exports=i(r)}var o=Array.prototype.slice,s=Array.prototype.join,a=function(){return"object"==typeof process&&"function"==typeof process.nextTick?process.nextTick:"function"==typeof setImmediate?setImmediate:function(t){setTimeout(t,0)}}(),u="undefined"!=typeof module&&module.exports&&"function"==typeof require,l="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(l)define(r);else if(u)r(require,module.exports,module);else{if(!t)return;i(t)}}("object"==typeof sinon&&sinon||null),/**
 * Stub functions
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2013 Christian Johansen
 */
function(t){function e(t){function e(n,i,r){if(r&&"function"!=typeof r)throw new TypeError("Custom stub should be function");var o;if(r)o=t.spy&&t.spy.create?t.spy.create(r):r;else{var s=0;"object"==typeof n&&"function"==typeof n[i]&&(s=n[i].length),o=e.create(s)}if(!n&&"undefined"==typeof i)return t.stub.create();if("undefined"==typeof i&&"object"==typeof n){for(var a in n)"function"==typeof n[a]&&e(n,a);return n}return t.wrapMethod(n,i,o)}function n(e){return e.defaultBehavior||i(e)||t.behavior.create(e)}function i(t){return t.parent&&r(t.parent)}function r(t){var e=t.behaviors[t.callCount-1];return e&&e.isPresent()?e:n(t)}var o=0,s={create:function(n){var i=function(){return r(i).invoke(this,arguments)};i.id="stub#"+o++;var s=i;return i=t.spy.create(i,n),i.func=s,t.extend(i,e),i.instantiateFake=t.stub.create,i.displayName="stub",i.toString=t.functionToString,i.defaultBehavior=null,i.behaviors=[],i},resetBehavior:function(){var t;if(this.defaultBehavior=null,this.behaviors=[],delete this.returnValue,delete this.returnArgAt,this.returnThis=!1,this.fakes)for(t=0;t<this.fakes.length;t++)this.fakes[t].resetBehavior()},onCall:function(e){return this.behaviors[e]||(this.behaviors[e]=t.behavior.create(this)),this.behaviors[e]},onFirstCall:function(){return this.onCall(0)},onSecondCall:function(){return this.onCall(1)},onThirdCall:function(){return this.onCall(2)}};for(var a in t.behavior)t.behavior.hasOwnProperty(a)&&!s.hasOwnProperty(a)&&"create"!=a&&"withArgs"!=a&&"invoke"!=a&&(s[a]=function(e){return function(){return this.defaultBehavior=this.defaultBehavior||t.behavior.create(this),this.defaultBehavior[e].apply(this.defaultBehavior,arguments),this}}(a));return t.extend(e,s),t.stub=e,e}function n(t,n,i){var r=t("./util/core");t("./behavior"),t("./spy"),i.exports=e(r)}var i="undefined"!=typeof module&&module.exports&&"function"==typeof require,r="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(r)define(n);else if(i)n(require,module.exports,module);else{if(!t)return;e(t)}}("object"==typeof sinon&&sinon||null),/**
 * Mock functions.
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2013 Christian Johansen
 */
function(t){function e(t){function e(n){return n?e.create(n):t.expectation.create("Anonymous mock")}function n(t,e){if(t)for(var n=0,i=t.length;i>n;n+=1)e(t[n])}function i(t){return 0==t?"never called":"called "+c(t)}function r(t){var e=t.minCalls,n=t.maxCalls;if("number"==typeof e&&"number"==typeof n){var i=c(e);return e!=n&&(i="at least "+i+" and at most "+c(n)),i}return"number"==typeof e?"at least "+c(e):"at most "+c(n)}function o(t){var e="number"==typeof t.minCalls;return!e||t.callCount>=t.minCalls}function s(t){return"number"!=typeof t.maxCalls?!1:t.callCount==t.maxCalls}function a(t,e){return l&&l.isMatcher(t)?t.test(e):!0}var u=[].push,l=t.match;t.extend(e,{create:function(n){if(!n)throw new TypeError("object is null");var i=t.extend({},e);return i.object=n,delete i.create,i},expects:function(e){if(!e)throw new TypeError("method is falsy");if(this.expectations||(this.expectations={},this.proxies=[]),!this.expectations[e]){this.expectations[e]=[];var n=this;t.wrapMethod(this.object,e,function(){return n.invokeMethod(e,this,arguments)}),u.call(this.proxies,e)}var i=t.expectation.create(e);return u.call(this.expectations[e],i),i},restore:function(){var t=this.object;n(this.proxies,function(e){"function"==typeof t[e].restore&&t[e].restore()})},verify:function(){var e=this.expectations||{},i=[],r=[];return n(this.proxies,function(t){n(e[t],function(t){t.met()?u.call(r,t.toString()):u.call(i,t.toString())})}),this.restore(),i.length>0?t.expectation.fail(i.concat(r).join("\n")):r.length>0&&t.expectation.pass(i.concat(r).join("\n")),!0},invokeMethod:function(e,n,i){var r,o=this.expectations&&this.expectations[e],s=o&&o.length||0;for(r=0;s>r;r+=1)if(!o[r].met()&&o[r].allowsCall(n,i))return o[r].apply(n,i);var a,l=[],c=0;for(r=0;s>r;r+=1)o[r].allowsCall(n,i)?a=a||o[r]:c+=1,u.call(l,"    "+o[r].toString());return 0===c?a.apply(n,i):(l.unshift("Unexpected call: "+t.spyCall.toString.call({proxy:e,args:i})),void t.expectation.fail(l.join("\n")))}});var c=t.timesInWords,f=Array.prototype.slice;return t.expectation={minCalls:1,maxCalls:1,create:function(e){var n=t.extend(t.stub.create(),t.expectation);return delete n.create,n.method=e,n},invoke:function(e,n,i){return this.verifyCallAllowed(n,i),t.spy.invoke.apply(this,arguments)},atLeast:function(t){if("number"!=typeof t)throw new TypeError("'"+t+"' is not number");return this.limitsSet||(this.maxCalls=null,this.limitsSet=!0),this.minCalls=t,this},atMost:function(t){if("number"!=typeof t)throw new TypeError("'"+t+"' is not number");return this.limitsSet||(this.minCalls=null,this.limitsSet=!0),this.maxCalls=t,this},never:function(){return this.exactly(0)},once:function(){return this.exactly(1)},twice:function(){return this.exactly(2)},thrice:function(){return this.exactly(3)},exactly:function(t){if("number"!=typeof t)throw new TypeError("'"+t+"' is not a number");return this.atLeast(t),this.atMost(t)},met:function(){return!this.failed&&o(this)},verifyCallAllowed:function(e,n){if(s(this)&&(this.failed=!0,t.expectation.fail(this.method+" already called "+c(this.maxCalls))),"expectedThis"in this&&this.expectedThis!==e&&t.expectation.fail(this.method+" called with "+e+" as thisValue, expected "+this.expectedThis),"expectedArguments"in this){n||t.expectation.fail(this.method+" received no arguments, expected "+t.format(this.expectedArguments)),n.length<this.expectedArguments.length&&t.expectation.fail(this.method+" received too few arguments ("+t.format(n)+"), expected "+t.format(this.expectedArguments)),this.expectsExactArgCount&&n.length!=this.expectedArguments.length&&t.expectation.fail(this.method+" received too many arguments ("+t.format(n)+"), expected "+t.format(this.expectedArguments));for(var i=0,r=this.expectedArguments.length;r>i;i+=1)a(this.expectedArguments[i],n[i])||t.expectation.fail(this.method+" received wrong arguments "+t.format(n)+", didn't match "+this.expectedArguments.toString()),t.deepEqual(this.expectedArguments[i],n[i])||t.expectation.fail(this.method+" received wrong arguments "+t.format(n)+", expected "+t.format(this.expectedArguments))}},allowsCall:function(e,n){if(this.met()&&s(this))return!1;if("expectedThis"in this&&this.expectedThis!==e)return!1;if(!("expectedArguments"in this))return!0;if(n=n||[],n.length<this.expectedArguments.length)return!1;if(this.expectsExactArgCount&&n.length!=this.expectedArguments.length)return!1;for(var i=0,r=this.expectedArguments.length;r>i;i+=1){if(!a(this.expectedArguments[i],n[i]))return!1;if(!t.deepEqual(this.expectedArguments[i],n[i]))return!1}return!0},withArgs:function(){return this.expectedArguments=f.call(arguments),this},withExactArgs:function(){return this.withArgs.apply(this,arguments),this.expectsExactArgCount=!0,this},on:function(t){return this.expectedThis=t,this},toString:function(){var e=(this.expectedArguments||[]).slice();this.expectsExactArgCount||u.call(e,"[...]");var n=t.spyCall.toString.call({proxy:this.method||"anonymous mock expectation",args:e}),o=n.replace(", [...","[, ...")+" "+r(this);return this.met()?"Expectation met: "+o:"Expected "+o+" ("+i(this.callCount)+")"},verify:function(){return this.met()?t.expectation.pass(this.toString()):t.expectation.fail(this.toString()),!0},pass:function(e){t.assert.pass(e)},fail:function(t){var e=new Error(t);throw e.name="ExpectationError",e}},t.mock=e,e}function n(t,n,i){var r=t("./util/core");t("./call"),t("./match"),t("./spy"),i.exports=e(r)}var i="undefined"!=typeof module&&module.exports&&"function"==typeof require,r="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(r)define(n);else if(i)n(require,module.exports,module);else{if(!t)return;e(t)}}("object"==typeof sinon&&sinon||null),/**
 * Collections of stubs, spies and mocks.
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2013 Christian Johansen
 */
function(t){function e(t){return t.fakes||(t.fakes=[]),t.fakes}function n(t,n){for(var i=e(t),r=0,o=i.length;o>r;r+=1)"function"==typeof i[r][n]&&i[r][n]()}function i(t){for(var n=e(t),i=0;i<n.length;)n.splice(i,1)}function r(t){var r={verify:function(){n(this,"verify")},restore:function(){n(this,"restore"),i(this)},reset:function(){n(this,"reset")},verifyAndRestore:function(){var t;try{this.verify()}catch(e){t=e}if(this.restore(),t)throw t},add:function(t){return s.call(e(this),t),t},spy:function(){return this.add(t.spy.apply(t,arguments))},stub:function(e,n,i){if(n){var r=e[n];if("function"!=typeof r){if(!a.call(e,n))throw new TypeError("Cannot stub non-existent own property "+n);return e[n]=i,this.add({restore:function(){e[n]=r}})}}if(!n&&e&&"object"==typeof e){var o=t.stub.apply(t,arguments);for(var s in o)"function"==typeof o[s]&&this.add(o[s]);return o}return this.add(t.stub.apply(t,arguments))},mock:function(){return this.add(t.mock.apply(t,arguments))},inject:function(t){var e=this;return t.spy=function(){return e.spy.apply(e,arguments)},t.stub=function(){return e.stub.apply(e,arguments)},t.mock=function(){return e.mock.apply(e,arguments)},t}};return t.collection=r,r}function o(t,e,n){var i=t("./util/core");t("./mock"),t("./spy"),t("./stub"),n.exports=r(i)}var s=[].push,a=Object.prototype.hasOwnProperty,u="undefined"!=typeof module&&module.exports&&"function"==typeof require,l="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(l)define(o);else if(u)o(require,module.exports,module);else{if(!t)return;r(t)}}("object"==typeof sinon&&sinon||null),"undefined"==typeof sinon)var sinon={};/**
 * The Sinon "server" mimics a web server that receives requests from
 * sinon.FakeXMLHttpRequest and provides an API to respond to those requests,
 * both synchronously and asynchronously. To respond synchronuously, canned
 * answers have to be provided upfront.
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2013 Christian Johansen
 */
if(function(t){function e(t,e){var n="undefined"!=typeof lolex?lolex:e;t.useFakeTimers=function(){var t,e=Array.prototype.slice.call(arguments);t="string"==typeof e[0]?0:e.shift();var i=n.install(t||0,e);return i.restore=i.uninstall,i},t.clock={create:function(t){return n.createClock(t)}},t.timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setImmediate:"undefined"!=typeof setImmediate?setImmediate:void 0,clearImmediate:"undefined"!=typeof clearImmediate?clearImmediate:void 0,setInterval:setInterval,clearInterval:clearInterval,Date:Date}}function n(t,n,i){var r=t("./core");e(r,t("lolex")),i.exports=r}var i="undefined"!=typeof module&&module.exports&&"function"==typeof require,r="function"==typeof define&&"object"==typeof define.amd&&define.amd;r?define(n):i?n(require,module.exports,module):e(sinon)}("undefined"!=typeof global&&"function"!=typeof global?global:this),/**
 * Minimal Event interface implementation
 *
 * Original implementation by Sven Fuchs: https://gist.github.com/995028
 * Modifications and tests by Christian Johansen.
 *
 * @author Sven Fuchs (svenfuchs@artweb-design.de)
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2011 Sven Fuchs, Christian Johansen
 */
"undefined"==typeof sinon&&(this.sinon={}),function(){function t(t){t.Event=function(t,e,n,i){this.initEvent(t,e,n,i)},t.Event.prototype={initEvent:function(t,e,n,i){this.type=t,this.bubbles=e,this.cancelable=n,this.target=i},stopPropagation:function(){},preventDefault:function(){this.defaultPrevented=!0}},t.ProgressEvent=function(t,e,n){this.initEvent(t,!1,!1,n),this.loaded=e.loaded||null,this.total=e.total||null,this.lengthComputable=!!e.total},t.ProgressEvent.prototype=new t.Event,t.ProgressEvent.prototype.constructor=t.ProgressEvent,t.CustomEvent=function(t,e,n){this.initEvent(t,!1,!1,n),this.detail=e.detail||null},t.CustomEvent.prototype=new t.Event,t.CustomEvent.prototype.constructor=t.CustomEvent,t.EventTarget={addEventListener:function(t,e){this.eventListeners=this.eventListeners||{},this.eventListeners[t]=this.eventListeners[t]||[],n.call(this.eventListeners[t],e)},removeEventListener:function(t,e){for(var n=this.eventListeners&&this.eventListeners[t]||[],i=0,r=n.length;r>i;++i)if(n[i]==e)return n.splice(i,1)},dispatchEvent:function(t){for(var e=t.type,n=this.eventListeners&&this.eventListeners[e]||[],i=0;i<n.length;i++)"function"==typeof n[i]?n[i].call(this,t):n[i].handleEvent(t);return!!t.defaultPrevented}}}function e(e){var n=e("./core");t(n)}var n=[].push,i="undefined"!=typeof module&&module.exports&&"function"==typeof require,r="function"==typeof define&&"object"==typeof define.amd&&define.amd;r?define(e):i?e(require):t(sinon)}(),/**
 * Logs errors
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2014 Christian Johansen
 */
function(t){function e(t){function e(){}function n(e,i){var r=e+" threw exception: ";t.log(r+"["+i.name+"] "+i.message),i.stack&&t.log(i.stack),n.setTimeout(function(){throw i.message=r+i.message,i},0)}n.setTimeout=function(t,e){i(t,e)};var r={};return r.log=t.log=e,r.logError=t.logError=n,r}function n(t,n,i){var r=t("./util/core");i.exports=e(r)}var i=setTimeout,r="undefined"!=typeof module&&module.exports&&"function"==typeof require,o="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(o)define(n);else if(r)n(require,module.exports,module);else{if(!t)return;e(t)}}("object"==typeof sinon&&sinon||null),"undefined"==typeof sinon&&(this.sinon={}),function(t){function e(e){function n(){this.readyState=n.UNSENT,this.requestBody=null,this.requestHeaders={},this.status=0,this.timeout=null,"function"==typeof n.onCreate&&n.onCreate(this)}function r(t){if(t.readyState!==n.OPENED)throw new Error("INVALID_STATE_ERR");if(t.sendFlag)throw new Error("INVALID_STATE_ERR")}function o(t){if(t.readyState==n.UNSENT)throw new Error("Request not sent");if(t.readyState==n.DONE)throw new Error("Request done")}function s(t){if("string"!=typeof t){var e=new Error("Attempted to respond to fake XDomainRequest with "+t+", which is not a string.");throw e.name="InvalidBodyException",e}}e.xdr=i,e.extend(n.prototype,e.EventTarget,{open:function(t,e){this.method=t,this.url=e,this.responseText=null,this.sendFlag=!1,this.readyStateChange(n.OPENED)},readyStateChange:function(t){this.readyState=t;var i="";switch(this.readyState){case n.UNSENT:break;case n.OPENED:break;case n.LOADING:this.sendFlag&&(i="onprogress");break;case n.DONE:i=this.isTimeout?"ontimeout":this.errorFlag||this.status<200||this.status>299?"onerror":"onload"}if(i&&"function"==typeof this[i])try{this[i]()}catch(r){e.logError("Fake XHR "+i+" handler",r)}},send:function(t){r(this),/^(get|head)$/i.test(this.method)||(this.requestBody=t),this.requestHeaders["Content-Type"]="text/plain;charset=utf-8",this.errorFlag=!1,this.sendFlag=!0,this.readyStateChange(n.OPENED),"function"==typeof this.onSend&&this.onSend(this)},abort:function(){this.aborted=!0,this.responseText=null,this.errorFlag=!0,this.readyState>e.FakeXDomainRequest.UNSENT&&this.sendFlag&&(this.readyStateChange(e.FakeXDomainRequest.DONE),this.sendFlag=!1)},setResponseBody:function(t){o(this),s(t);var e=this.chunkSize||10,i=0;this.responseText="";do this.readyStateChange(n.LOADING),this.responseText+=t.substring(i,i+e),i+=e;while(i<t.length);this.readyStateChange(n.DONE)},respond:function(t,e,n){this.status="number"==typeof t?t:200,this.setResponseBody(n||"")},simulatetimeout:function(){this.status=0,this.isTimeout=!0,this.responseText=void 0,this.readyStateChange(n.DONE)}}),e.extend(n,{UNSENT:0,OPENED:1,LOADING:3,DONE:4}),e.useFakeXDomainRequest=function(){return e.FakeXDomainRequest.restore=function(n){i.supportsXDR&&(t.XDomainRequest=i.GlobalXDomainRequest),delete e.FakeXDomainRequest.restore,n!==!0&&delete e.FakeXDomainRequest.onCreate},i.supportsXDR&&(t.XDomainRequest=e.FakeXDomainRequest),e.FakeXDomainRequest},e.FakeXDomainRequest=n}function n(t,n,i){var r=t("./core");t("./event"),e(r),i.exports=r}var i={XDomainRequest:t.XDomainRequest};i.GlobalXDomainRequest=t.XDomainRequest,i.supportsXDR="undefined"!=typeof i.GlobalXDomainRequest,i.workingXDR=i.supportsXDR?i.GlobalXDomainRequest:!1;var r="undefined"!=typeof module&&module.exports&&"function"==typeof require,o="function"==typeof define&&"object"==typeof define.amd&&define.amd;o?define(n):r?n(require,module.exports,module):e(sinon)}(this),/**
 * Fake XMLHttpRequest object
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2013 Christian Johansen
 */
function(t){function e(){function t(t){i.addEventListener(t,function(e){var n=i["on"+t];n&&"function"==typeof n&&n.call(this,e)})}this.readyState=e.UNSENT,this.requestHeaders={},this.requestBody=null,this.status=0,this.statusText="",this.upload=new n,g.supportsCORS&&(this.withCredentials=!1);for(var i=this,r=["loadstart","load","abort","loadend"],o=r.length-1;o>=0;o--)t(r[o]);"function"==typeof e.onCreate&&e.onCreate(this)}function n(){this.eventListeners={progress:[],load:[],abort:[],error:[]}}function i(t){if(t.readyState!==e.OPENED)throw new Error("INVALID_STATE_ERR");if(t.sendFlag)throw new Error("INVALID_STATE_ERR")}function r(t,e){e=e.toLowerCase();for(var n in t)if(n.toLowerCase()==e)return n;return null}function o(t,e){if(t)for(var n=0,i=t.length;i>n;n+=1)e(t[n])}function s(t,e){for(var n=0;n<t.length;n++)if(e(t[n])===!0)return!0;return!1}function a(t){if(t.readyState!=e.OPENED)throw new Error("INVALID_STATE_ERR - "+t.readyState)}function u(t){if(t.readyState==e.DONE)throw new Error("Request done")}function l(t){if(t.async&&t.readyState!=e.HEADERS_RECEIVED)throw new Error("No headers received")}function c(t){if("string"!=typeof t){var e=new Error("Attempted to respond to fake XMLHttpRequest with "+t+", which is not a string.");throw e.name="InvalidBodyException",e}}function f(n){n.xhr=g,n.extend(e.prototype,n.EventTarget,{async:!0,open:function(t,n,i,r,o){if(this.method=t,this.url=n,this.async="boolean"==typeof i?i:!0,this.username=r,this.password=o,this.responseText=null,this.responseXML=null,this.requestHeaders={},this.sendFlag=!1,e.useFilters===!0){var a=arguments,u=s(e.filters,function(t){return t.apply(this,a)});if(u)return e.defake(this,arguments)}this.readyStateChange(e.OPENED)},readyStateChange:function(t){if(this.readyState=t,"function"==typeof this.onreadystatechange)try{this.onreadystatechange()}catch(i){n.logError("Fake XHR onreadystatechange handler",i)}switch(this.dispatchEvent(new n.Event("readystatechange")),this.readyState){case e.DONE:this.dispatchEvent(new n.Event("load",!1,!1,this)),this.dispatchEvent(new n.Event("loadend",!1,!1,this)),this.upload.dispatchEvent(new n.Event("load",!1,!1,this)),h&&(this.upload.dispatchEvent(new n.ProgressEvent("progress",{loaded:100,total:100})),this.dispatchEvent(new n.ProgressEvent("progress",{loaded:100,total:100})))}},setRequestHeader:function(t,e){if(i(this),m[t]||/^(Sec-|Proxy-)/.test(t))throw new Error('Refused to set unsafe header "'+t+'"');this.requestHeaders[t]?this.requestHeaders[t]+=","+e:this.requestHeaders[t]=e},setResponseHeaders:function(t){a(this),this.responseHeaders={};for(var n in t)t.hasOwnProperty(n)&&(this.responseHeaders[n]=t[n]);this.async?this.readyStateChange(e.HEADERS_RECEIVED):this.readyState=e.HEADERS_RECEIVED},send:function(t){if(i(this),!/^(get|head)$/i.test(this.method)){var o=r(this.requestHeaders,"Content-Type");if(this.requestHeaders[o]){var s=this.requestHeaders[o].split(";");this.requestHeaders[o]=s[0]+";charset=utf-8"}else t instanceof FormData||(this.requestHeaders["Content-Type"]="text/plain;charset=utf-8");this.requestBody=t}this.errorFlag=!1,this.sendFlag=this.async,this.readyStateChange(e.OPENED),"function"==typeof this.onSend&&this.onSend(this),this.dispatchEvent(new n.Event("loadstart",!1,!1,this))},abort:function(){this.aborted=!0,this.responseText=null,this.errorFlag=!0,this.requestHeaders={},this.readyState>e.UNSENT&&this.sendFlag&&(this.readyStateChange(e.DONE),this.sendFlag=!1),this.readyState=e.UNSENT,this.dispatchEvent(new n.Event("abort",!1,!1,this)),this.upload.dispatchEvent(new n.Event("abort",!1,!1,this)),"function"==typeof this.onerror&&this.onerror()},getResponseHeader:function(t){return this.readyState<e.HEADERS_RECEIVED?null:/^Set-Cookie2?$/i.test(t)?null:(t=r(this.responseHeaders,t),this.responseHeaders[t]||null)},getAllResponseHeaders:function(){if(this.readyState<e.HEADERS_RECEIVED)return"";var t="";for(var n in this.responseHeaders)this.responseHeaders.hasOwnProperty(n)&&!/^Set-Cookie2?$/i.test(n)&&(t+=n+": "+this.responseHeaders[n]+"\r\n");return t},setResponseBody:function(t){u(this),l(this),c(t);var n=this.chunkSize||10,i=0;this.responseText="";do this.async&&this.readyStateChange(e.LOADING),this.responseText+=t.substring(i,i+n),i+=n;while(i<t.length);var r=this.getResponseHeader("Content-Type");if(this.responseText&&(!r||/(text\/xml)|(application\/xml)|(\+xml)/.test(r)))try{this.responseXML=e.parseXML(this.responseText)}catch(o){}this.readyStateChange(e.DONE)},respond:function(t,n,i){this.status="number"==typeof t?t:200,this.statusText=e.statusCodes[this.status],this.setResponseHeaders(n||{}),this.setResponseBody(i||"")},uploadProgress:function(t){h&&this.upload.dispatchEvent(new n.ProgressEvent("progress",t))},downloadProgress:function(t){h&&this.dispatchEvent(new n.ProgressEvent("progress",t))},uploadError:function(t){p&&this.upload.dispatchEvent(new n.CustomEvent("error",{detail:t}))}}),n.extend(e,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4}),n.useFakeXMLHttpRequest=function(){return e.restore=function(n){g.supportsXHR&&(t.XMLHttpRequest=g.GlobalXMLHttpRequest),g.supportsActiveX&&(t.ActiveXObject=g.GlobalActiveXObject),delete e.restore,n!==!0&&delete e.onCreate},g.supportsXHR&&(t.XMLHttpRequest=e),g.supportsActiveX&&(t.ActiveXObject=function(t){return"Microsoft.XMLHTTP"==t||/^Msxml2\.XMLHTTP/i.test(t)?new e:new g.GlobalActiveXObject(t)}),e},n.FakeXMLHttpRequest=e}function d(t,e,n){var i=t("./core");t("./event"),f(i),n.exports=i}var h="undefined"!=typeof ProgressEvent,p="undefined"!=typeof CustomEvent,g={XMLHttpRequest:t.XMLHttpRequest};g.GlobalXMLHttpRequest=t.XMLHttpRequest,g.GlobalActiveXObject=t.ActiveXObject,g.supportsActiveX="undefined"!=typeof g.GlobalActiveXObject,g.supportsXHR="undefined"!=typeof g.GlobalXMLHttpRequest,g.workingXHR=g.supportsXHR?g.GlobalXMLHttpRequest:g.supportsActiveX?function(){return new g.GlobalActiveXObject("MSXML2.XMLHTTP.3.0")}:!1,g.supportsCORS=g.supportsXHR&&"withCredentials"in new g.GlobalXMLHttpRequest;var m={"Accept-Charset":!0,"Accept-Encoding":!0,Connection:!0,"Content-Length":!0,Cookie:!0,Cookie2:!0,"Content-Transfer-Encoding":!0,Date:!0,Expect:!0,Host:!0,"Keep-Alive":!0,Referer:!0,TE:!0,Trailer:!0,"Transfer-Encoding":!0,Upgrade:!0,"User-Agent":!0,Via:!0};n.prototype.addEventListener=function(t,e){this.eventListeners[t].push(e)},n.prototype.removeEventListener=function(t,e){for(var n=this.eventListeners[t]||[],i=0,r=n.length;r>i;++i)if(n[i]==e)return n.splice(i,1)},n.prototype.dispatchEvent=function(t){for(var e,n=this.eventListeners[t.type]||[],i=0;null!=(e=n[i]);i++)e(t)};var v=function(t,e,n){switch(n.length){case 0:return t[e]();case 1:return t[e](n[0]);case 2:return t[e](n[0],n[1]);case 3:return t[e](n[0],n[1],n[2]);case 4:return t[e](n[0],n[1],n[2],n[3]);case 5:return t[e](n[0],n[1],n[2],n[3],n[4])}};e.filters=[],e.addFilter=function(t){this.filters.push(t)};var y=/MSIE 6/;e.defake=function(t,n){var i=new g.workingXHR;o(["open","setRequestHeader","send","abort","getResponseHeader","getAllResponseHeaders","addEventListener","overrideMimeType","removeEventListener"],function(e){t[e]=function(){return v(i,e,arguments)}});var r=function(e){o(e,function(e){try{t[e]=i[e]}catch(n){if(!y.test(navigator.userAgent))throw n}})},s=function(){t.readyState=i.readyState,i.readyState>=e.HEADERS_RECEIVED&&r(["status","statusText"]),i.readyState>=e.LOADING&&r(["responseText","response"]),i.readyState===e.DONE&&r(["responseXML"]),t.onreadystatechange&&t.onreadystatechange.call(t,{target:t})};if(i.addEventListener){for(var a in t.eventListeners)t.eventListeners.hasOwnProperty(a)&&o(t.eventListeners[a],function(t){i.addEventListener(a,t)});i.addEventListener("readystatechange",s)}else i.onreadystatechange=s;v(i,"open",n)},e.useFilters=!1,e.parseXML=function(t){var e;if("undefined"!=typeof DOMParser){var n=new DOMParser;e=n.parseFromString(t,"text/xml")}else e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t);return e},e.statusCodes={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"};var b="undefined"!=typeof module&&module.exports&&"function"==typeof require,_="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(_)define(d);else if(b)d(require,module.exports,module);else{if("undefined"==typeof sinon)return;f(sinon)}}("undefined"!=typeof global?global:this),"undefined"==typeof sinon)var sinon={};/**
 * Add-on for sinon.fakeServer that automatically handles a fake timer along with
 * the FakeXMLHttpRequest. The direct inspiration for this add-on is jQuery
 * 1.3.x, which does not use xhr object's onreadystatehandler at all - instead,
 * it polls the object for completion with setInterval. Dispite the direct
 * motivation, there is nothing jQuery-specific in this file, so it can be used
 * in any environment where the ajax implementation depends on setInterval or
 * setTimeout.
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2013 Christian Johansen
 */
/**
 * Manages fake collections as well as fake utilities such as Sinon's
 * timers and fake XHR implementation in one convenient object.
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2013 Christian Johansen
 */
/**
 * Test function, sandboxes fakes
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2013 Christian Johansen
 */
/**
 * Test case, sandboxes all test functions
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2013 Christian Johansen
 */
/**
 * Assertions matching the test spy retrieval interface.
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2013 Christian Johansen
 */
return function(){function t(){}function e(e){return t.prototype=e,new t}function n(t){var e=t;if("[object Array]"!=Object.prototype.toString.call(t)&&(e=[200,{},t]),"string"!=typeof e[2])throw new TypeError("Fake server response body should be string, but was "+typeof e[2]);return e}function i(t,e,n){var i=t.method,r=!i||i.toLowerCase()==e.toLowerCase(),o=t.url,s=!o||o==n||"function"==typeof o.test&&o.test(n);return r&&s}function r(t,e){var n=e.url;if((!/^https?:\/\//.test(n)||l.test(n))&&(n=n.replace(l,"")),i(t,this.getHTTPMethod(e),n)){if("function"==typeof t.response){var r=t.url,o=[e].concat(r&&"function"==typeof r.exec?r.exec(n).slice(1):[]);return t.response.apply(t,o)}return!0}return!1}function o(t){t.fakeServer={create:function(){var n=e(this);return t.xhr.supportsCORS?this.xhr=t.useFakeXMLHttpRequest():this.xhr=t.useFakeXDomainRequest(),n.requests=[],this.xhr.onCreate=function(t){n.addRequest(t)},n},addRequest:function(t){var e=this;a.call(this.requests,t),t.onSend=function(){e.handleRequest(this),e.autoRespond&&!e.responding&&(setTimeout(function(){e.responding=!1,e.respond()},e.autoRespondAfter||10),e.responding=!0)}},getHTTPMethod:function(t){if(this.fakeHTTPMethods&&/post/i.test(t.method)){var e=(t.requestBody||"").match(/_method=([^\b;]+)/);return e?e[1]:t.method}return t.method},handleRequest:function(t){t.async?(this.queue||(this.queue=[]),a.call(this.queue,t)):this.processRequest(t)},log:function(e,n){var i;i="Request:\n"+t.format(n)+"\n\n",i+="Response:\n"+t.format(e)+"\n\n",t.log(i)},respondWith:function(t,e,i){return 1==arguments.length&&"function"!=typeof t?void(this.response=n(t)):(this.responses||(this.responses=[]),1==arguments.length&&(i=t,e=t=null),2==arguments.length&&(i=e,e=t,t=null),void a.call(this.responses,{method:t,url:e,response:"function"==typeof i?i:n(i)}))},respond:function(){arguments.length>0&&this.respondWith.apply(this,arguments);for(var t,e=this.queue||[],n=e.splice(0,e.length);t=n.shift();)this.processRequest(t)},processRequest:function(e){try{if(e.aborted)return;var n=this.response||[404,{},""];if(this.responses)for(var i=this.responses.length,o=i-1;o>=0;o--)if(r.call(this,this.responses[o],e)){n=this.responses[o].response;break}4!=e.readyState&&(this.log(n,e),e.respond(n[0],n[1],n[2]))}catch(s){t.logError("Fake server request processing",s)}},restore:function(){return this.xhr.restore&&this.xhr.restore.apply(this.xhr,arguments)}}}function s(t,e,n){var i=t("./core");t("./fake_xdomain_request"),t("./fake_xml_http_request"),o(i),n.exports=i}var a=[].push,u="undefined"!=typeof window?window.location:{},l=new RegExp("^"+u.protocol+"//"+u.host),c="undefined"!=typeof module&&module.exports&&"function"==typeof require,f="function"==typeof define&&"object"==typeof define.amd&&define.amd;f?define(s):c?s(require,module.exports,module):o(sinon)}(),function(){function t(t){function e(){}e.prototype=t.fakeServer,t.fakeServerWithClock=new e,t.fakeServerWithClock.addRequest=function(e){if(e.async&&("object"==typeof setTimeout.clock?this.clock=setTimeout.clock:(this.clock=t.useFakeTimers(),this.resetClock=!0),!this.longestTimeout)){var n=this.clock.setTimeout,i=this.clock.setInterval,r=this;this.clock.setTimeout=function(t,e){return r.longestTimeout=Math.max(e,r.longestTimeout||0),n.apply(this,arguments)},this.clock.setInterval=function(t,e){return r.longestTimeout=Math.max(e,r.longestTimeout||0),i.apply(this,arguments)}}return t.fakeServer.addRequest.call(this,e)},t.fakeServerWithClock.respond=function(){var e=t.fakeServer.respond.apply(this,arguments);return this.clock&&(this.clock.tick(this.longestTimeout||0),this.longestTimeout=0,this.resetClock&&(this.clock.restore(),this.resetClock=!1)),e},t.fakeServerWithClock.restore=function(){return this.clock&&this.clock.restore(),t.fakeServer.restore.apply(this,arguments)}}function e(e){var n=e("./core");e("./fake_server"),e("./fake_timers"),t(n)}var n="undefined"!=typeof module&&module.exports&&"function"==typeof require,i="function"==typeof define&&"object"==typeof define.amd&&define.amd;i?define(e):n?e(require):t(sinon)}(),function(){function t(t){function e(t,e,n,r){r&&(!e.injectInto||n in e.injectInto?i.call(t.args,r):(e.injectInto[n]=r,t.injectedKeys.push(n)))}function n(e){var n=t.create(t.sandbox);return e.useFakeServer&&("object"==typeof e.useFakeServer&&(n.serverPrototype=e.useFakeServer),n.useFakeServer()),e.useFakeTimers&&("object"==typeof e.useFakeTimers?n.useFakeTimers.apply(n,e.useFakeTimers):n.useFakeTimers()),n}var i=[].push;return t.sandbox=t.extend(t.create(t.collection),{useFakeTimers:function(){return this.clock=t.useFakeTimers.apply(t,arguments),this.add(this.clock)},serverPrototype:t.fakeServer,useFakeServer:function(){var e=this.serverPrototype||t.fakeServer;return e&&e.create?(this.server=e.create(),this.add(this.server)):null},inject:function(e){return t.collection.inject.call(this,e),this.clock&&(e.clock=this.clock),this.server&&(e.server=this.server,e.requests=this.server.requests),e.match=t.match,e},restore:function(){t.collection.restore.apply(this,arguments),this.restoreContext()},restoreContext:function(){if(this.injectedKeys){for(var t=0,e=this.injectedKeys.length;e>t;t++)delete this.injectInto[this.injectedKeys[t]];this.injectedKeys=[]}},create:function(i){if(!i)return t.create(t.sandbox);var r=n(i);r.args=r.args||[],r.injectedKeys=[],r.injectInto=i.injectInto;var o,s,a=r.inject({});if(i.properties)for(var u=0,l=i.properties.length;l>u;u++)o=i.properties[u],s=a[o]||"sandbox"==o&&r,e(r,i,o,s);else e(r,i,"sandbox",s);return r},match:t.match}),t.sandbox.useFakeXMLHttpRequest=t.sandbox.useFakeServer,t.sandbox}function e(e,n,i){var r=e("./util/core");e("./util/fake_server"),e("./util/fake_timers"),e("./collection"),i.exports=t(r)}var n="undefined"!=typeof module&&module.exports&&"function"==typeof require,i="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(i)define(e);else if(n)e(require,module.exports,module);else{if(!sinon)return;t(sinon)}}(),function(t){function e(t){function e(e){function n(){var n=t.getConfig(t.config);n.injectInto=n.injectIntoThis&&this||n.injectInto;var i,r,o=t.sandbox.create(n),s=!1,a=Array.prototype.slice.call(arguments);if(a.length>0&&"function"==typeof a[arguments.length-1]){var u=a[arguments.length-1];a[arguments.length-1]=function(t){if(t)throw o.restore(),i;o.verifyAndRestore(),u(t)},s=!0}var l=a.concat(o.args);try{r=e.apply(this,l)}catch(c){i=c}if(!s){if("undefined"!=typeof i)throw o.restore(),i;o.verifyAndRestore()}return r}var i=typeof e;if("function"!=i)throw new TypeError("sinon.test needs to wrap a test function, got "+i);return e.length?function(t){return n.apply(this,arguments)}:n}return e.config={injectIntoThis:!0,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:!0,useFakeServer:!0},t.test=e,e}function n(t,n,i){var r=t("./util/core");t("./sandbox"),i.exports=e(r)}var i="undefined"!=typeof module&&module.exports&&"function"==typeof require,r="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(r)define(n);else if(i)n(require,module.exports,module);else{if(!t)return;e(t)}}("object"==typeof sinon&&sinon||null),function(t){function e(t,e,n){return function(){e&&e.apply(this,arguments);var i,r;try{r=t.apply(this,arguments)}catch(o){i=o}if(n&&n.apply(this,arguments),i)throw i;return r}}function n(t){function n(n,i){if(!n||"object"!=typeof n)throw new TypeError("sinon.testCase needs an object with test functions");i=i||"test";var r,o,s,a=new RegExp("^"+i),u={},l=n.setUp,c=n.tearDown;for(r in n)if(n.hasOwnProperty(r)){if(o=n[r],/^(setUp|tearDown)$/.test(r))continue;"function"==typeof o&&a.test(r)?(s=o,(l||c)&&(s=e(o,l,c)),u[r]=t.test(s)):u[r]=n[r]}return u}return t.testCase=n,n}function i(t,e,i){var r=t("./util/core");t("./test"),i.exports=n(r)}var r="undefined"!=typeof module&&module.exports&&"function"==typeof require,o="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(o)define(i);else if(r)i(require,module.exports,module);else{if(!t)return;n(t)}}("object"==typeof sinon&&sinon||null),function(t,e){function n(t){function n(){for(var t,e=0,i=arguments.length;i>e;++e)t=arguments[e],t||a.fail("fake is not a spy"),t.proxy?n(t.proxy):("function"!=typeof t&&a.fail(t+" is not a function"),"function"!=typeof t.getCall&&a.fail(t+" is not stubbed"))}function i(t,n){t=t||e;var i=t.fail||a.fail;i.call(t,n)}function o(t,e,o){2==arguments.length&&(o=e,e=t),a[t]=function(s){n(s);var u=r.call(arguments,1),l=!1;l="function"==typeof e?!e(s):"function"==typeof s[e]?!s[e].apply(s,u):!s[e],l?i(this,(s.printf||s.proxy.printf).apply(s,[o].concat(u))):a.pass(t)}}function s(t,e){return!t||/^fail/.test(e)?e:t+e.slice(0,1).toUpperCase()+e.slice(1)}var a;return a={failException:"AssertError",fail:function(t){var e=new Error(t);throw e.name=this.failException||a.failException,e},pass:function(t){},callOrder:function(){n.apply(null,arguments);var e="",o="";if(t.calledInOrder(arguments))a.pass("callOrder");else{try{e=[].join.call(arguments,", ");for(var s=r.call(arguments),u=s.length;u;)s[--u].called||s.splice(u,1);o=t.orderByFirstCall(s).join(", ")}catch(l){}i(this,"expected "+e+" to be called in order but were called as "+o)}},callCount:function(e,r){if(n(e),e.callCount!=r){var o="expected %n to be called "+t.timesInWords(r)+" but was called %c%C";i(this,e.printf(o))}else a.pass("callCount")},expose:function(t,e){if(!t)throw new TypeError("target is null or undefined");var n=e||{},i="undefined"==typeof n.prefix&&"assert"||n.prefix,r="undefined"==typeof n.includeFail||!!n.includeFail;for(var o in this)"expose"==o||!r&&/^(fail)/.test(o)||(t[s(i,o)]=this[o]);return t},match:function(e,n){var r=t.match(n);if(r.test(e))a.pass("match");else{var o=["expected value to match","    expected = "+t.format(n),"    actual = "+t.format(e)];i(this,o.join("\n"))}}},o("called","expected %n to have been called at least once but was never called"),o("notCalled",function(t){return!t.called},"expected %n to not have been called but was called %c%C"),o("calledOnce","expected %n to be called once but was called %c%C"),o("calledTwice","expected %n to be called twice but was called %c%C"),o("calledThrice","expected %n to be called thrice but was called %c%C"),o("calledOn","expected %n to be called with %1 as this but was called with %t"),o("alwaysCalledOn","expected %n to always be called with %1 as this but was called with %t"),o("calledWithNew","expected %n to be called with new"),o("alwaysCalledWithNew","expected %n to always be called with new"),o("calledWith","expected %n to be called with arguments %*%C"),o("calledWithMatch","expected %n to be called with match %*%C"),o("alwaysCalledWith","expected %n to always be called with arguments %*%C"),o("alwaysCalledWithMatch","expected %n to always be called with match %*%C"),o("calledWithExactly","expected %n to be called with exact arguments %*%C"),o("alwaysCalledWithExactly","expected %n to always be called with exact arguments %*%C"),o("neverCalledWith","expected %n to never be called with arguments %*%C"),o("neverCalledWithMatch","expected %n to never be called with match %*%C"),o("threw","%n did not throw exception%C"),o("alwaysThrew","%n did not always throw exception%C"),t.assert=a,a}function i(t,e,i){var r=t("./util/core");t("./match"),i.exports=n(r)}var r=Array.prototype.slice,o="undefined"!=typeof module&&module.exports&&"function"==typeof require,s="function"==typeof define&&"object"==typeof define.amd&&define.amd;if(s)define(i);else if(o)i(require,module.exports,module);else{if(!t)return;n(t)}}("object"==typeof sinon&&sinon||null,"undefined"!=typeof window?window:"undefined"!=typeof self?self:global),sinon});