/*! Copyright (c) 2011, Lloyd Hilaiel, ISC License */
!function(e){function t(e){try{return JSON&&JSON.parse?JSON.parse(e):new Function("return "+e)()}catch(t){r("ijs")}}function r(e){throw new Error(p[e])}function n(e){return Array.isArray?Array.isArray(e):"[object Array]"===u.call(e)}function o(e){if(null===e)return"null";var t=typeof e;return"object"===t&&n(e)&&(t="array"),t}function i(e,t,r,n,i){var a,s=[],f=">"===t[0]?t[1]:t[0],u=!0;return f.type&&(u=u&&f.type===o(e)),f.id&&(u=u&&f.id===r),u&&f.pf&&(":nth-last-child"===f.pf?n=i-n:n++,0===f.a?u=f.b===n:(a=(n-f.b)%f.a,u=!a&&n*f.a+f.b>=0)),">"!==t[0]&&":root"!==t[0].pc&&s.push(t),u&&(">"===t[0]?t.length>2&&(u=!1,s.push(t.slice(2))):t.length>1&&(u=!1,s.push(t.slice(1)))),[u,s]}function a(e,t,r,o,s,f){var u,p,c=","===e[0]?e.slice(1):[e],l=[],h=!1,d=0,g=0,y=0;for(d=0;d<c.length;d++)for(p=i(t,c[d],o,s,f),p[0]&&(h=!0),g=0;g<p[1].length;g++)l.push(p[1][g]);if(l.length&&"object"==typeof t)if(l.length>=1&&l.unshift(","),n(t))for(d=0;d<t.length;d++)a(l,t[d],r,void 0,d,t.length);else{y=0;for(u in t)t.hasOwnProperty(u)&&y++;d=0;for(u in t)t.hasOwnProperty(u)&&a(l,t[u],r,u,d++,y)}h&&r&&r(t)}function s(e,t){var r=[];return a(e,t,function(e){r.push(e)}),r}function f(e){return{sel:g(e),match:function(e){return s(this.sel,e)},forEach:function(e,t){return a(this.sel,e,t)}}}var u=Object.prototype.toString,p={ijs:"invalid json string",mpc:"multiple pseudo classes (:xxx) not allowed",mepf:"malformed expression in pseudo-function",nmi:"multiple ids not allowed",se:"selector expected",sra:"string required after '.'",uc:"unrecognized char",ujs:"unclosed json string",upc:"unrecognized pseudo class"},c={psc:1,psf:2,typ:3,str:4},l=/^(?:([\r\n\t\ ]+)|([*.,>])|(string|boolean|null|array|object|number)|(:(?:root|first-child|last-child|only-child))|(:(?:nth-child|nth-last-child))|(:\w+)|(\"(?:[^\\]|\\[^\"])*\")|(\")|((?:[_a-zA-Z]|[^\0-\0177]|\\[^\r\n\f0-9a-fA-F])(?:[_a-zA-Z0-9\-]|[^\u0000-\u0177]|(?:\\[^\r\n\f0-9a-fA-F]))*))/,h=/^\s*\(\s*(?:([+\-]?)([0-9]*)n\s*(?:([+\-])\s*([0-9]))?|(odd|even)|([+\-]?[0-9]+))\s*\)/,d=function(e,n){n||(n=0);var o=l.exec(e.substr(n));if(!o)return void 0;n+=o[0].length;var i;return o[1]?i=[n," "]:o[2]?i=[n,o[0]]:o[3]?i=[n,c.typ,o[0]]:o[4]?i=[n,c.psc,o[0]]:o[5]?i=[n,c.psf,o[0]]:o[6]?r("upc"):o[7]?i=[n,c.str,t(o[0])]:o[8]?r("ujs"):o[9]&&(i=[n,c.str,o[0].replace(/\\([^\r\n\f0-9a-fA-F])/g,"$1")]),i},g=function(e){for(var t,r=[],n=0;;){var o=y(e,n);if(r.push(o[1]),o=d(e,n=o[0]),o&&" "===o[1]&&(o=d(e,n=o[0])),!o)break;">"===o[1]?(r.push(">"),n=o[0]):","===o[1]&&(void 0===t?t=[",",r]:t.push(r),r=[],n=o[0])}return t&&t.push(r),t?t:r},y=function(e,t){var n=t,o={},i=d(e,t);for(i&&" "===i[1]&&(n=t=i[0],i=d(e,t)),i&&i[1]===c.typ?(o.type=i[2],i=d(e,t=i[0])):i&&"*"===i[1]&&(i=d(e,t=i[0]));;){if(void 0===i)break;if("."===i[1])i=d(e,t=i[0]),i&&i[1]===c.str||r("sra"),o.id&&r("nmi"),o.id=i[2];else if(i[1]===c.psc)(o.pc||o.pf)&&r("mpc"),":first-child"===i[2]?(o.pf=":nth-child",o.a=0,o.b=1):":last-child"===i[2]?(o.pf=":nth-last-child",o.a=0,o.b=1):o.pc=i[2];else{if(i[1]!==c.psf)break;(o.pc||o.pf)&&r("mpc"),o.pf=i[2];var a=h.exec(e.substr(i[0]));a||r("mepf"),a[5]?(o.a=2,o.b="odd"===a[5]?1:0):a[6]?(o.a=0,o.b=parseInt(a[6],10)):(o.a=parseInt((a[1]?a[1]:"+")+(a[2]?a[2]:"1"),10),o.b=a[3]?parseInt(a[3]+a[4],10):0),i[0]+=a[0].length}i=d(e,t=i[0])}return n===t&&r("se"),[t,o]};e._lex=d,e._parse=g,e.match=function(e,t){return f(e).match(t)},e.forEach=function(e,t,r){return f(e).forEach(t,r)},e.compile=f}("undefined"==typeof exports?window.JSONSelect={}:exports);