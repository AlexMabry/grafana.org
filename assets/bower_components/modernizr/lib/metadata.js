function metadata(e){var t=[];return file.walkSync(viewRoot,function(e,n,r){r.forEach(function(n){if(".DS_Store"!==n){var r,i=fs.readFileSync(e+"/"+n,"utf8"),o=/\/\*\!([\s\S]*)\!\*\//m,a=i.match(o),s=/\/\*\sDOC([\s\S]*?)\*\//m,c=i.match(s),u=/define\((\[[^\]]*\]),/,A=i.match(u);if(a&&a[1])try{r=JSON.parse(a[1])}catch(l){throw new Error("Error Parsing Metadata: "+n+"\nInput: `"+a[1]+"`")}else r={};var d=null;c&&c[1]&&(d=marked(c[1].trim())),r.doc=d;var f,p=[];if(!A||!A[1])throw new Error("Couldn't find the define for `"+n+"`");try{f=JSON.parse(A[1].replace(/'/g,'"'))}catch(l){throw new Error("Couldn't parse dependencies for `"+n+"`:\n`"+A[1]+"\n`")}f.forEach(function(e){"Modernizr"!==e&&p.push(e)}),r.deps=p;var m=__dirname.replace(/lib$/,"");r.path="./"+(e+"/"+n).replace(m,"").replace(/\\/g,"/"),r.amdPath=r.path.replace(/^\.\/feature\-detects/,"test").replace(/\.js$/i,""),r.name||(r.name=r.amdPath);var h=[];r.polyfills&&r.polyfills.length&&r.polyfills.forEach(function(e){if(!polyfills[e])throw new Error(r.name+": Polyfill not found in `"+n+"`: "+e);h.push(polyfills[e])}),r.polyfills=h,r.async||(r.async=!1),r.notes||(r.notes=[]),r.warnings||(r.warnings=[]),r.caniuse||(r.caniuse=null),!r.cssclass&&r.property?r.cssclass=r.property:r.cssclass=null,!r.doc&&r.docs&&(r.doc=r.docs,delete r.docs),r.tags||(r.tags=[]),r.authors||(r.authors=[]),r.knownBugs||(r.knownBugs=[]),t.push(r)}})}),e&&"function"==typeof e?e(t):t}var fs=require("fs"),file=require("file"),marked=require("marked"),polyfills=require("./polyfills.json"),viewRoot=fs.realpathSync(__dirname+"/../feature-detects");module.exports=metadata;