function metadata(n){var t=[];return file.walkSync(viewRoot,function(n,r,e){e.forEach(function(r){if(".DS_Store"!==r){var e,u=fs.readFileSync(n+"/"+r,"utf8"),i=/\/\*\!([\s\S]*)\!\*\//m,o=u.match(i),a=/\/\*\sDOC([\s\S]*?)\*\//m,f=u.match(a),c=/define\((\[[^\]]*\]),/,l=u.match(c);if(o&&o[1])try{e=JSON.parse(o[1])}catch(s){throw new Error("Error Parsing Metadata: "+r+"\nInput: `"+o[1]+"`")}else e={};var p=null;f&&f[1]&&(p=marked(f[1].trim())),e.doc=p;var h,g=[];if(!l||!l[1])throw new Error("Couldn't find the define for `"+r+"`");try{h=JSON.parse(l[1].replace(/'/g,'"'))}catch(s){throw new Error("Couldn't parse dependencies for `"+r+"`:\n`"+l[1]+"\n`")}h.forEach(function(n){"Modernizr"!==n&&g.push(n)}),e.deps=g;var v=__dirname.replace(/lib$/,"");e.path="./"+(n+"/"+r).replace(v,"").replace(/\\/g,"/"),e.amdPath=e.path.replace(/^\.\/feature\-detects/,"test").replace(/\.js$/i,""),e.name||(e.name=e.amdPath);var d=[];e.polyfills&&e.polyfills.length&&e.polyfills.forEach(function(n){if(!polyfills[n])throw new Error(e.name+": Polyfill not found in `"+r+"`: "+n);d.push(polyfills[n])}),e.polyfills=d,e.async||(e.async=!1),e.notes||(e.notes=[]),e.warnings||(e.warnings=[]),e.caniuse||(e.caniuse=null),!e.cssclass&&e.property?e.cssclass=e.property:e.cssclass=null,!e.doc&&e.docs&&(e.doc=e.docs,delete e.docs),e.tags||(e.tags=[]),e.authors||(e.authors=[]),e.knownBugs||(e.knownBugs=[]),t.push(e)}})}),n&&"function"==typeof n?n(t):t}var fs=require("fs"),file=require("file"),marked=require("marked"),polyfills=require("./polyfills.json"),viewRoot=fs.realpathSync(__dirname+"/../feature-detects");module.exports=metadata;